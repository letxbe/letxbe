# LetXBe SDK
![pydantic](https://img.shields.io/badge/dependencies-pydantic-brightgreen)

Connect to the LetXBe API and perform simple actions.

# Start here

This package contains both an API wrapper to connect to the LetXBe API and the
necessary types to handle input and output data from the API. To install it, 
simply run `pip install letxbe`.

You will need to set the `SERVER_ADDRESS` environment variable. It should point
to the API you mean to use (dev or prod environment).

# Basic usage
The main object used in this package is `LXB`. It needs to be initialized using
a `client_id` and `client_secret` provided by Auth0:
```python
from letxbe import LXB

CLIENT_ID = "ClientID"
CLIENT_SECRET = "ClientSecret"

lxb = LXB(CLIENT_ID, CLIENT_SECRET)
```
You can access the Authorization header generated by the connection via the 
property `LXB.authorization_header`.

## Post a target
```python
from letxbe import LXB
from letxbe.type import ClientEnv, Metadata

CLIENT_ID = "ClientID"
CLIENT_SECRET = "ClientSecret"
lxb = LXB(CLIENT_ID, CLIENT_SECRET)

ATTACHED_ARTEFACT_SLUG = "artefact-slug"
ATTACHED_ARTEFACT_NAME = "artefact-name"
ATMS_SLUG = "automatisme-slug"
CLIENT_ENV = ClientEnv.PROD
METADATA = Metadata.parse_obj(
    {
        "slug": "document-slug",
        "extension": "pdf",
        "name": "file",
        "form": {},
        "artefact": {
            ATTACHED_ARTEFACT_NAME: {"slug": ATTACHED_ARTEFACT_SLUG}
        }
    }
)
FILE = open("file.pdf", "rb").read()

http_response = lxb.post_target(ATMS_SLUG, CLIENT_ENV, METADATA, FILE)
```

## Post an artefact
```python
from letxbe import LXB
from letxbe.type import ClientEnv, Metadata

CLIENT_ID = "ClientID"
CLIENT_SECRET = "ClientSecret"
lxb = LXB(CLIENT_ID, CLIENT_SECRET)

ARTEFACT_NAME = "artefact-name"
ARTEFACT_SLUG = "artefact-slug"
ATMS_SLUG = "automatisme-slug"
CLIENT_ENV = ClientEnv.PROD
METADATA = Metadata.parse_obj(
    {
        "slug": "document-slug",
        "extension": "csv",
        "name": "file",
        "form": {},
        "artefact": {ARTEFACT_NAME: {"slug": ARTEFACT_SLUG}}
    }
)
ROLE = "artefact-role"
FILE = open("file.csv", "rb").read()

http_response = lxb.post_artefact(
    ATMS_SLUG, CLIENT_ENV, ROLE, METADATA, FILE
)
```

## Post a feedback
```python
from letxbe import LXB
from letxbe.type import Feedback
from letxbe.type.enum import FeedbackVote

CLIENT_ID = "ClientID"
CLIENT_SECRET = "ClientSecret"
lxb = LXB(CLIENT_ID, CLIENT_SECRET)

ATMS_SLUG = "automatisme-slug"
DOC_SLUG = "document-slug"
FEEDBACK = Feedback.parse_obj(
    {
        "identifier": "optional-identifier",
        "comment": "feedback to add",
        "result": {
            "label-key": {
                "value": "predicted-value-for-label-key",
                "vote": FeedbackVote.INVALID
            }
        }
    }
)

feedback_response = lxb.post_feedback(ATMS_SLUG, DOC_SLUG, FEEDBACK)
```

## Get a document
```python
from letxbe import LXB

CLIENT_ID = "ClientID"
CLIENT_SECRET = "ClientSecret"
lxb = LXB(CLIENT_ID, CLIENT_SECRET)

ATMS_SLUG = "automatisme-slug"
DOC_SLUG = "document-slug"

document = lxb.get_document(ATMS_SLUG, DOC_SLUG)
```

# Contribute to the package

## Useful commands

* Formatting the project's code, type-checking, linter and unit tests:
```sh
sh -c "isort . && black ."
flake8 .
mypy .
pytest -v .
```

# TODO
* Add better handling of HTTP status when there's an error
* Clarify Metadata for `post_target`
* Clarify what should be returned for `post_target` and `post_artefact`
* Improve testing with integration tests
* Improve README