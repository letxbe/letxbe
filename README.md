# letxbe
[![pydantic](https://img.shields.io/badge/dependencies-pydantic-brightgreen)](https://pydantic-docs.helpmanual.io/)
[![pydantic](https://img.shields.io/badge/dependencies-requests-brightgreen)](https://pypi.org/project/requests)
![Circle CI](https://img.shields.io/circleci/build/bitbucket/onogone/letxbe?token=00601288e2fce2f6e8f35da8bcc0e154342f8eed)
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/ambv/black)
![MIT Licence](https://img.shields.io/github/license/letxbeai/letxbe)

Connect and control [LetXBe services](http://letxbe.ai/) via a python API.

**letxbe** package contains an API wrapper to connect to [LetXBe API](http://letxbe.ai/)
and the necessary types to handle input and output data.

## Install

To install the package simply run `pip install letxbe`.

Developers should install dev-requirements via `pip install -r requirements-dev.txt`.


# Basic usage
> :warning: You need to set the `SERVER_ADDRESS` environment variable. 
> It should point to the API you mean to use (dev or prod environment).

The main object used in this package is the class `LXB` that must be initialized to
establish the connection with our servers.

Every object used by `LXB` is type-validated via
[pydantic](https://pydantic-docs.helpmanual.io/).

## Connection
You need the `client_id` and `client_secret` provided by Auth0 to initialise `LXB`:
```python
from letxbe import LXB

CLIENT_ID = "ClientID"
CLIENT_SECRET = "ClientSecret"

lxb = LXB(CLIENT_ID, CLIENT_SECRET)
```
You can access the Authorization header generated by the connection via the 
property `LXB.authorization_header`.


## Common actions
### Post an artefact
```python
from letxbe.type import ClientEnv, Metadata

atms_slug = "automatisme-slug"
client_env = ClientEnv.PROD

role = "artefact_role"

# An existent artefact can be connected to the new one
other_role = "other_artefact_role"
other_artefact_slug = "other-artefact-slug"

metadata = Metadata(
    client_env=client_env,
    name="Name to give the document for users to identify it easily.",
    extension="csv",
    form={},
    artefact={
        other_role: {"slug": other_artefact_slug}
    }
)
file = open("your_artefact_file.csv", "rb").read()

new_artefact_slug = lxb.post_artefact(
    atms_slug, role, metadata, file
)
```

### Post a target connected to an artefact
```python
from letxbe.type import ClientEnv, Metadata

atms_slug = "automatisme-slug"
client_env = ClientEnv.PROD

# An existent artefact can be connected to the target
artefact_role = "artefact_role"
artefact_slug = "artefact-slug"

metadata = Metadata(
    client_env=client_env,
    name="Name to give the document for users to identify it easily.",
    extension="pdf",
    form={},
    artefact={
        artefact_role: {"slug": artefact_slug}
    }
)
file = open("your_target_file.pdf", "rb").read()

NEW_TARGET_SLUG = lxb.post_target(atms_slug, metadata, file)
```

### Post a feedback
```python
from letxbe.type import Feedback
from letxbe.type.enum import FeedbackVote

atms_slug = "automatisme-slug"
doc_slug = "document-slug"
feedback = Feedback.parse_obj(
    {
        "identifier": "optional-identifier",
        "comment": "feedback to add",
        "result": {
            "label-key": {
                "value": "predicted-value-for-label-key",
                "vote": FeedbackVote.INVALID
            }
        }
    }
)

feedback_response = lxb.post_feedback(atms_slug, doc_slug, feedback)
```

### Get a document
```python
atms_slug = "automatisme-slug"
doc_slug = "document-slug"

document = lxb.get_document(atms_slug, doc_slug)
```


# Issues

## Known issues

## Report an issue

Use github default issue tracker or contact us via email at 
[team@letxbe.ai](mailto:team@letxbe.ai).

# TODO
* Generate documentation for type sub-package
* Add better handling of HTTP status when there's an error
* Use python badge shields based on classifiers in setup, see
  https://shields.io/category/platform-support

# License

MIT Licence.

# Changelog

## Alpha

### Alpha

* added LXB class to connect to LetXBe API
* simple api calls: get_document, post_target, post_artefact, post_feedback
* basic typing for input/output
